controller:
  image:
    registry: {{ internal_network_ki_cp_dns_name }}:{{ ki_cp_k8s_registry_port }}
    image: ingress-nginx/controller
    tag: "v1.10.0"
    digest: null
    digestChroot: null
  allowSnippetAnnotations: true
  config:
    log-format-upstream: |-
      [$time_local] peer: $remote_addr    request_host: $host    request: $request
      request_length: $request_length    basic_auth_user: $remote_user    referer: $http_referer    user_agent: $http_user_agent
      response_status: $status    total_elapsed_time: $request_time    response_body_sent_bytes: $body_bytes_sent
      upstream_ingress: $namespace/$ingress_name    upstream_service: $namespace/$service_name:$service_port    upstream_request_addr: $upstream_addr
      upstream_response_status: $upstream_status    upstream_response_time: $upstream_response_time    upstream_response_length: $upstream_response_length
  hostPort:
    enabled: {{ hostport }}
    ports:
      http: {{ http_hostport }}
      https: {{ https_hostport }}
  ingressClassResource:
    name: {{ ingress_class_name }}
    controllerValue: k8s.io/ingress-nginx/{{ ingress_class_name }}
  ingressClass: {{ ingress_class_name }}
  kind: DaemonSet
  tolerations:
    - key: "node-role.kubernetes.io/control-plane"
      operator: "Exists"
      effect: "NoSchedule"
  affinity:
    nodeAffinity:
      requiredDuringSchedulingIgnoredDuringExecution:
        nodeSelectorTerms:
          - matchExpressions:
              - key: kubernetes.io/hostname
                operator: In
                values:
{%- for knn in knn_list %}
                  - {{ knn }}
{%- endfor %}
  service:
    enabled: true
{%- if pool_name %}
    annotations:
      metallb.universe.tf/address-pool: {{ pool_name }}
{%- endif %}
    externalTrafficPolicy: "Local"
    allocateLoadBalancerNodePorts: false
  admissionWebhooks:
    patch:
      image:
        registry: {{ internal_network_ki_cp_dns_name }}:{{ ki_cp_k8s_registry_port }}
        image: ingress-nginx/kube-webhook-certgen
        tag: v1.4.0
        digest: null
      tolerations:
        - key: "node-role.kubernetes.io/control-plane"
          operator: "Exists"
          effect: "NoSchedule"
